{"ast":null,"code":"import React,{createContext,useContext,useState,useEffect}from'react';import{createUserWithEmailAndPassword,signInWithEmailAndPassword,signOut,onAuthStateChanged,updateProfile}from'firebase/auth';import{ref,set,get}from'firebase/database';import{auth,database}from'../firebase';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export function useAuth(){return useContext(AuthContext);}export function AuthProvider(_ref){let{children}=_ref;const[currentUser,setCurrentUser]=useState(null);const[userRole,setUserRole]=useState(null);const[loading,setLoading]=useState(true);async function register(email,password,displayName){try{const userCredential=await createUserWithEmailAndPassword(auth,email,password);const user=userCredential.user;// Cập nhật displayName\nawait updateProfile(user,{displayName});// Lưu thông tin người dùng vào Realtime Database\nawait set(ref(database,\"users/\".concat(user.uid)),{email:user.email,displayName,role:'user',createdAt:Date.now()});return user;}catch(error){throw error;}}function login(email,password){return signInWithEmailAndPassword(auth,email,password);}function logout(){return signOut(auth);}async function getUserRole(uid){try{const userSnapshot=await get(ref(database,\"users/\".concat(uid)));if(userSnapshot.exists()){const userData=userSnapshot.val();return userData.role||'user';}return'user';}catch(error){console.error('Lỗi khi lấy vai trò người dùng:',error);return'user';}}useEffect(()=>{const unsubscribe=onAuthStateChanged(auth,async user=>{if(user){const role=await getUserRole(user.uid);setCurrentUser(user);setUserRole(role);}else{setCurrentUser(null);setUserRole(null);}setLoading(false);});return()=>unsubscribe();},[]);const value={currentUser,userRole,register,login,logout,isAdmin:userRole==='admin'};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:!loading&&children});}","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","createUserWithEmailAndPassword","signInWithEmailAndPassword","signOut","onAuthStateChanged","updateProfile","ref","set","get","auth","database","jsx","_jsx","AuthContext","useAuth","AuthProvider","_ref","children","currentUser","setCurrentUser","userRole","setUserRole","loading","setLoading","register","email","password","displayName","userCredential","user","concat","uid","role","createdAt","Date","now","error","login","logout","getUserRole","userSnapshot","exists","userData","val","console","unsubscribe","value","isAdmin","Provider"],"sources":["C:/Users/User/OneDrive/Documents/VSCode/web/WebAPPP/client/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport {\n  createUserWithEmailAndPassword,\n  signInWithEmailAndPassword,\n  signOut,\n  onAuthStateChanged,\n  updateProfile\n} from 'firebase/auth';\nimport { ref, set, get } from 'firebase/database';\nimport { auth, database } from '../firebase';\n\nconst AuthContext = createContext();\n\nexport function useAuth() {\n  return useContext(AuthContext);\n}\n\nexport function AuthProvider({ children }) {\n  const [currentUser, setCurrentUser] = useState(null);\n  const [userRole, setUserRole] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  async function register(email, password, displayName) {\n    try {\n      const userCredential = await createUserWithEmailAndPassword(auth, email, password);\n      const user = userCredential.user;\n\n      // Cập nhật displayName\n      await updateProfile(user, { displayName });\n\n      // Lưu thông tin người dùng vào Realtime Database\n      await set(ref(database, `users/${user.uid}`), {\n        email: user.email,\n        displayName,\n        role: 'user',\n        createdAt: Date.now()\n      });\n\n      return user;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  function login(email, password) {\n    return signInWithEmailAndPassword(auth, email, password);\n  }\n\n  function logout() {\n    return signOut(auth);\n  }\n\n  async function getUserRole(uid) {\n    try {\n      const userSnapshot = await get(ref(database, `users/${uid}`));\n      if (userSnapshot.exists()) {\n        const userData = userSnapshot.val();\n        return userData.role || 'user';\n      }\n      return 'user';\n    } catch (error) {\n      console.error('Lỗi khi lấy vai trò người dùng:', error);\n      return 'user';\n    }\n  }\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (user) => {\n      if (user) {\n        const role = await getUserRole(user.uid);\n        setCurrentUser(user);\n        setUserRole(role);\n      } else {\n        setCurrentUser(null);\n        setUserRole(null);\n      }\n      setLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, []);\n\n  const value = {\n    currentUser,\n    userRole,\n    register,\n    login,\n    logout,\n    isAdmin: userRole === 'admin'\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {!loading && children}\n    </AuthContext.Provider>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}