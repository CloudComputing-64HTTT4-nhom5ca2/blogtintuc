{"ast":null,"code":"import _objectSpread from\"C:/Users/User/OneDrive/Documents/VSCode/web/WebAPPP/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{Link}from'react-router-dom';import{ref,onValue,remove}from'firebase/database';import{database}from'../../firebase';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminPosts=()=>{const[posts,setPosts]=useState([]);const[loading,setLoading]=useState(true);const[error,setError]=useState('');useEffect(()=>{const postsRef=ref(database,'posts');const unsubscribe=onValue(postsRef,snapshot=>{setLoading(true);try{const postsData=snapshot.val()||{};// Chuyển đổi đối tượng posts thành mảng và sắp xếp theo thời gian tạo (mới nhất trước)\nconst postsArray=Object.keys(postsData).map(id=>_objectSpread({id},postsData[id])).sort((a,b)=>b.createdAt-a.createdAt);setPosts(postsArray);setError('');}catch(error){console.error('Lỗi khi tải dữ liệu bài viết:',error);setError('Không thể tải dữ liệu bài viết. Vui lòng thử lại sau.');}finally{setLoading(false);}});// Cleanup function\nreturn()=>unsubscribe();},[]);const handleDeletePost=async postId=>{if(window.confirm('Bạn có chắc chắn muốn xóa bài viết này?')){try{// Xóa bài viết\nawait remove(ref(database,\"posts/\".concat(postId)));// Xóa bình luận liên quan\nawait remove(ref(database,\"comments/\".concat(postId)));// Xóa đánh giá liên quan\nawait remove(ref(database,\"ratings/\".concat(postId)));// Không cần cập nhật state vì onValue listener sẽ tự động cập nhật\n}catch(error){console.error('Lỗi khi xóa bài viết:',error);setError('Không thể xóa bài viết. Vui lòng thử lại sau.');}}};const formatDate=timestamp=>{if(!timestamp)return'';const date=new Date(timestamp);return date.toLocaleDateString('vi-VN',{year:'numeric',month:'short',day:'numeric'});};return/*#__PURE__*/_jsxs(\"div\",{className:\"admin-posts-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"header-actions\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"Qu\\u1EA3n l\\xFD b\\xE0i vi\\u1EBFt\"}),/*#__PURE__*/_jsx(Link,{to:\"/admin/posts/create\",className:\"btn btn-success\",children:\"T\\u1EA1o b\\xE0i vi\\u1EBFt m\\u1EDBi\"})]}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"})}):posts.length>0?/*#__PURE__*/_jsx(\"div\",{className:\"admin-posts-table\",children:/*#__PURE__*/_jsxs(\"table\",{children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Ti\\xEAu \\u0111\\u1EC1\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Danh m\\u1EE5c\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Ng\\xE0y \\u0111\\u0103ng\"}),/*#__PURE__*/_jsx(\"th\",{children:\"L\\u01B0\\u1EE3t xem\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0110\\xE1nh gi\\xE1\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Thao t\\xE1c\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:posts.map(post=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsx(Link,{to:\"/post/\".concat(post.id),children:post.title})}),/*#__PURE__*/_jsx(\"td\",{children:post.category}),/*#__PURE__*/_jsx(\"td\",{children:formatDate(post.createdAt)}),/*#__PURE__*/_jsx(\"td\",{children:post.viewCount||0}),/*#__PURE__*/_jsx(\"td\",{children:post.averageRating?/*#__PURE__*/_jsxs(\"span\",{children:[\"\\u2B50 \",post.averageRating.toFixed(1),\" (\",post.ratingCount,\")\"]}):/*#__PURE__*/_jsx(\"span\",{children:\"Ch\\u01B0a c\\xF3 \\u0111\\xE1nh gi\\xE1\"})}),/*#__PURE__*/_jsxs(\"td\",{className:\"actions\",children:[/*#__PURE__*/_jsx(Link,{to:\"/admin/posts/edit/\".concat(post.id),className:\"btn-edit\",children:\"S\\u1EEDa\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDeletePost(post.id),className:\"btn-delete\",children:\"X\\xF3a\"})]})]},post.id))})]})}):/*#__PURE__*/_jsx(\"p\",{className:\"no-posts\",children:\"Ch\\u01B0a c\\xF3 b\\xE0i vi\\u1EBFt n\\xE0o.\"})]});};export default AdminPosts;","map":{"version":3,"names":["React","useState","useEffect","Link","ref","onValue","remove","database","jsx","_jsx","jsxs","_jsxs","AdminPosts","posts","setPosts","loading","setLoading","error","setError","postsRef","unsubscribe","snapshot","postsData","val","postsArray","Object","keys","map","id","_objectSpread","sort","a","b","createdAt","console","handleDeletePost","postId","window","confirm","concat","formatDate","timestamp","date","Date","toLocaleDateString","year","month","day","className","children","to","length","post","title","category","viewCount","averageRating","toFixed","ratingCount","onClick"],"sources":["C:/Users/User/OneDrive/Documents/VSCode/web/WebAPPP/client/src/pages/admin/AdminPosts.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { ref, onValue, remove } from 'firebase/database';\nimport { database } from '../../firebase';\n\nconst AdminPosts = () => {\n  const [posts, setPosts] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState('');\n\n  useEffect(() => {\n    const postsRef = ref(database, 'posts');\n\n    const unsubscribe = onValue(postsRef, (snapshot) => {\n      setLoading(true);\n\n      try {\n        const postsData = snapshot.val() || {};\n\n        // Chuyển đổi đối tượng posts thành mảng và sắp xếp theo thời gian tạo (mới nhất trước)\n        const postsArray = Object.keys(postsData).map(id => ({\n          id,\n          ...postsData[id]\n        })).sort((a, b) => b.createdAt - a.createdAt);\n\n        setPosts(postsArray);\n        setError('');\n      } catch (error) {\n        console.error('Lỗi khi tải dữ liệu bài viết:', error);\n        setError('Không thể tải dữ liệu bài viết. Vui lòng thử lại sau.');\n      } finally {\n        setLoading(false);\n      }\n    });\n\n    // Cleanup function\n    return () => unsubscribe();\n  }, []);\n\n  const handleDeletePost = async (postId) => {\n    if (window.confirm('Bạn có chắc chắn muốn xóa bài viết này?')) {\n      try {\n        // Xóa bài viết\n        await remove(ref(database, `posts/${postId}`));\n\n        // Xóa bình luận liên quan\n        await remove(ref(database, `comments/${postId}`));\n\n        // Xóa đánh giá liên quan\n        await remove(ref(database, `ratings/${postId}`));\n\n        // Không cần cập nhật state vì onValue listener sẽ tự động cập nhật\n\n      } catch (error) {\n        console.error('Lỗi khi xóa bài viết:', error);\n        setError('Không thể xóa bài viết. Vui lòng thử lại sau.');\n      }\n    }\n  };\n\n  const formatDate = (timestamp) => {\n    if (!timestamp) return '';\n    const date = new Date(timestamp);\n    return date.toLocaleDateString('vi-VN', {\n      year: 'numeric',\n      month: 'short',\n      day: 'numeric'\n    });\n  };\n\n  return (\n    <div className=\"admin-posts-container\">\n      <div className=\"header-actions\">\n        <h1>Quản lý bài viết</h1>\n        <Link to=\"/admin/posts/create\" className=\"btn btn-success\">Tạo bài viết mới</Link>\n      </div>\n\n      {error && <div className=\"error-message\">{error}</div>}\n\n      {loading ? (\n        <div className=\"loading\">\n          <div className=\"spinner\"></div>\n        </div>\n      ) : posts.length > 0 ? (\n        <div className=\"admin-posts-table\">\n          <table>\n            <thead>\n              <tr>\n                <th>Tiêu đề</th>\n                <th>Danh mục</th>\n                <th>Ngày đăng</th>\n                <th>Lượt xem</th>\n                <th>Đánh giá</th>\n                <th>Thao tác</th>\n              </tr>\n            </thead>\n            <tbody>\n              {posts.map(post => (\n                <tr key={post.id}>\n                  <td><Link to={`/post/${post.id}`}>{post.title}</Link></td>\n                  <td>{post.category}</td>\n                  <td>{formatDate(post.createdAt)}</td>\n                  <td>{post.viewCount || 0}</td>\n                  <td>\n                    {post.averageRating ? (\n                      <span>⭐ {post.averageRating.toFixed(1)} ({post.ratingCount})</span>\n                    ) : (\n                      <span>Chưa có đánh giá</span>\n                    )}\n                  </td>\n                  <td className=\"actions\">\n                    <Link to={`/admin/posts/edit/${post.id}`} className=\"btn-edit\">Sửa</Link>\n                    <button\n                      onClick={() => handleDeletePost(post.id)}\n                      className=\"btn-delete\"\n                    >\n                      Xóa\n                    </button>\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      ) : (\n        <p className=\"no-posts\">Chưa có bài viết nào.</p>\n      )}\n    </div>\n  );\n};\n\nexport default AdminPosts;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}