{"ast":null,"code":"import React,{useState,useRef,useEffect}from'react';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const ImageUploader=_ref=>{let{onImageSelected,currentImage}=_ref;const[image,setImage]=useState(null);const[preview,setPreview]=useState('');const[dragActive,setDragActive]=useState(false);const fileInputRef=useRef(null);const dropAreaRef=useRef(null);const containerRef=useRef(null);// Khởi tạo với hình ảnh hiện tại (nếu có)\nuseEffect(()=>{if(currentImage){setPreview(currentImage);}},[currentImage]);// Xử lý file ảnh sau khi chọn\nconst handleImageFile=file=>{if(!file||!file.type.match('image.*'))return;setImage(file);// Tạo URL preview\nconst reader=new FileReader();reader.onloadend=()=>{setPreview(reader.result);onImageSelected(file,reader.result);};reader.readAsDataURL(file);};// Browse file\nconst handleFileInputChange=e=>{if(e.target.files&&e.target.files[0]){handleImageFile(e.target.files[0]);}};// Click vào vùng kéo thả sẽ mở dialog chọn file\nconst handleAreaClick=()=>{fileInputRef.current.click();};// Xử lý kéo thả\nconst handleDragEnter=e=>{e.preventDefault();e.stopPropagation();setDragActive(true);};const handleDragLeave=e=>{e.preventDefault();e.stopPropagation();setDragActive(false);};const handleDragOver=e=>{e.preventDefault();e.stopPropagation();};const handleDrop=e=>{e.preventDefault();e.stopPropagation();setDragActive(false);if(e.dataTransfer.files&&e.dataTransfer.files[0]){handleImageFile(e.dataTransfer.files[0]);}};// Xử lý paste từ clipboard - cải tiến để hoạt động mọi lúc\nuseEffect(()=>{const handlePaste=e=>{// Kiểm tra xem phần tử đang focus có phải là thẻ input hoặc textarea không\nconst activeElement=document.activeElement;const isInputOrTextarea=activeElement.tagName==='INPUT'||activeElement.tagName==='TEXTAREA';// Nếu người dùng đang focus vào một phần tử input hoặc textarea,\n// không xử lý paste để không ảnh hưởng đến hành vi nhập liệu\nif(isInputOrTextarea){return;}// Xử lý paste từ clipboard\nif(e.clipboardData&&e.clipboardData.files.length>0){const file=e.clipboardData.files[0];handleImageFile(file);e.preventDefault();}};// Thêm focus vào vùng drop area khi click vào container\nconst handleContainerClick=()=>{if(!preview&&dropAreaRef.current){dropAreaRef.current.focus();}};window.addEventListener('paste',handlePaste);if(containerRef.current){containerRef.current.addEventListener('click',handleContainerClick);}return()=>{window.removeEventListener('paste',handlePaste);if(containerRef.current){containerRef.current.removeEventListener('click',handleContainerClick);}};},[preview]);// Xóa ảnh đã chọn\nconst handleRemoveImage=e=>{e.stopPropagation();// Ngăn không cho click lan ra ngoài\nsetImage(null);setPreview('');onImageSelected(null,'');// Reset input file để có thể chọn lại file cũ\nif(fileInputRef.current){fileInputRef.current.value='';}};return/*#__PURE__*/_jsxs(\"div\",{className:\"image-uploader\",ref:containerRef,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"upload-area \".concat(dragActive?'drag-active':'',\" \").concat(preview?'has-preview':''),onClick:preview?null:handleAreaClick,onDragEnter:handleDragEnter,onDragLeave:handleDragLeave,onDragOver:handleDragOver,onDrop:handleDrop,ref:dropAreaRef,tabIndex:\"0\",children:[!preview?/*#__PURE__*/_jsxs(\"div\",{className:\"upload-placeholder\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-cloud-upload-alt\"}),/*#__PURE__*/_jsx(\"p\",{children:\"K\\xE9o th\\u1EA3 h\\xECnh \\u1EA3nh v\\xE0o \\u0111\\xE2y ho\\u1EB7c click \\u0111\\u1EC3 ch\\u1ECDn\"}),/*#__PURE__*/_jsx(\"p\",{className:\"upload-hint\",children:\"B\\u1EA1n c\\u0169ng c\\xF3 th\\u1EC3 d\\xE1n (Ctrl+V) h\\xECnh \\u1EA3nh \\u1EDF b\\u1EA5t k\\u1EF3 \\u0111\\xE2u\"})]}):/*#__PURE__*/_jsxs(\"div\",{className:\"image-preview-container\",children:[/*#__PURE__*/_jsx(\"img\",{src:preview,alt:\"Preview\",className:\"image-preview\"}),/*#__PURE__*/_jsx(\"button\",{type:\"button\",className:\"remove-image-btn\",onClick:handleRemoveImage,children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-times\"})})]}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",ref:fileInputRef,onChange:handleFileInputChange,accept:\"image/*\",className:\"file-input\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"upload-instructions\",children:/*#__PURE__*/_jsx(\"p\",{children:\"H\\u1ED7 tr\\u1EE3: JPG, JPEG, PNG, GIF (Max: 5MB)\"})})]});};export default ImageUploader;","map":{"version":3,"names":["React","useState","useRef","useEffect","jsx","_jsx","jsxs","_jsxs","ImageUploader","_ref","onImageSelected","currentImage","image","setImage","preview","setPreview","dragActive","setDragActive","fileInputRef","dropAreaRef","containerRef","handleImageFile","file","type","match","reader","FileReader","onloadend","result","readAsDataURL","handleFileInputChange","e","target","files","handleAreaClick","current","click","handleDragEnter","preventDefault","stopPropagation","handleDragLeave","handleDragOver","handleDrop","dataTransfer","handlePaste","activeElement","document","isInputOrTextarea","tagName","clipboardData","length","handleContainerClick","focus","window","addEventListener","removeEventListener","handleRemoveImage","value","className","ref","children","concat","onClick","onDragEnter","onDragLeave","onDragOver","onDrop","tabIndex","src","alt","onChange","accept"],"sources":["C:/Users/User/OneDrive/Documents/VSCode/web/WebAPPP/client/src/components/ImageUploader.js"],"sourcesContent":["import React, { useState, useRef, useEffect } from 'react';\n\nconst ImageUploader = ({ onImageSelected, currentImage }) => {\n  const [image, setImage] = useState(null);\n  const [preview, setPreview] = useState('');\n  const [dragActive, setDragActive] = useState(false);\n  const fileInputRef = useRef(null);\n  const dropAreaRef = useRef(null);\n  const containerRef = useRef(null);\n\n  // Khởi tạo với hình ảnh hiện tại (nếu có)\n  useEffect(() => {\n    if (currentImage) {\n      setPreview(currentImage);\n    }\n  }, [currentImage]);\n\n  // Xử lý file ảnh sau khi chọn\n  const handleImageFile = (file) => {\n    if (!file || !file.type.match('image.*')) return;\n\n    setImage(file);\n\n    // Tạo URL preview\n    const reader = new FileReader();\n    reader.onloadend = () => {\n      setPreview(reader.result);\n      onImageSelected(file, reader.result);\n    };\n    reader.readAsDataURL(file);\n  };\n\n  // Browse file\n  const handleFileInputChange = (e) => {\n    if (e.target.files && e.target.files[0]) {\n      handleImageFile(e.target.files[0]);\n    }\n  };\n\n  // Click vào vùng kéo thả sẽ mở dialog chọn file\n  const handleAreaClick = () => {\n    fileInputRef.current.click();\n  };\n\n  // Xử lý kéo thả\n  const handleDragEnter = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(true);\n  };\n\n  const handleDragLeave = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n  };\n\n  const handleDragOver = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n  };\n\n  const handleDrop = (e) => {\n    e.preventDefault();\n    e.stopPropagation();\n    setDragActive(false);\n\n    if (e.dataTransfer.files && e.dataTransfer.files[0]) {\n      handleImageFile(e.dataTransfer.files[0]);\n    }\n  };\n\n  // Xử lý paste từ clipboard - cải tiến để hoạt động mọi lúc\n  useEffect(() => {\n    const handlePaste = (e) => {\n      // Kiểm tra xem phần tử đang focus có phải là thẻ input hoặc textarea không\n      const activeElement = document.activeElement;\n      const isInputOrTextarea =\n        activeElement.tagName === 'INPUT' ||\n        activeElement.tagName === 'TEXTAREA';\n\n      // Nếu người dùng đang focus vào một phần tử input hoặc textarea,\n      // không xử lý paste để không ảnh hưởng đến hành vi nhập liệu\n      if (isInputOrTextarea) {\n        return;\n      }\n\n      // Xử lý paste từ clipboard\n      if (e.clipboardData && e.clipboardData.files.length > 0) {\n        const file = e.clipboardData.files[0];\n        handleImageFile(file);\n        e.preventDefault();\n      }\n    };\n\n    // Thêm focus vào vùng drop area khi click vào container\n    const handleContainerClick = () => {\n      if (!preview && dropAreaRef.current) {\n        dropAreaRef.current.focus();\n      }\n    };\n\n    window.addEventListener('paste', handlePaste);\n\n    if (containerRef.current) {\n      containerRef.current.addEventListener('click', handleContainerClick);\n    }\n\n    return () => {\n      window.removeEventListener('paste', handlePaste);\n\n      if (containerRef.current) {\n        containerRef.current.removeEventListener('click', handleContainerClick);\n      }\n    };\n  }, [preview]);\n\n  // Xóa ảnh đã chọn\n  const handleRemoveImage = (e) => {\n    e.stopPropagation(); // Ngăn không cho click lan ra ngoài\n    setImage(null);\n    setPreview('');\n    onImageSelected(null, '');\n\n    // Reset input file để có thể chọn lại file cũ\n    if (fileInputRef.current) {\n      fileInputRef.current.value = '';\n    }\n  };\n\n  return (\n    <div className=\"image-uploader\" ref={containerRef}>\n      <div\n        className={`upload-area ${dragActive ? 'drag-active' : ''} ${preview ? 'has-preview' : ''}`}\n        onClick={preview ? null : handleAreaClick}\n        onDragEnter={handleDragEnter}\n        onDragLeave={handleDragLeave}\n        onDragOver={handleDragOver}\n        onDrop={handleDrop}\n        ref={dropAreaRef}\n        tabIndex=\"0\"\n      >\n        {!preview ? (\n          <div className=\"upload-placeholder\">\n            <i className=\"fas fa-cloud-upload-alt\"></i>\n            <p>Kéo thả hình ảnh vào đây hoặc click để chọn</p>\n            <p className=\"upload-hint\">Bạn cũng có thể dán (Ctrl+V) hình ảnh ở bất kỳ đâu</p>\n          </div>\n        ) : (\n          <div className=\"image-preview-container\">\n            <img src={preview} alt=\"Preview\" className=\"image-preview\" />\n            <button\n              type=\"button\"\n              className=\"remove-image-btn\"\n              onClick={handleRemoveImage}\n            >\n              <i className=\"fas fa-times\"></i>\n            </button>\n          </div>\n        )}\n        <input\n          type=\"file\"\n          ref={fileInputRef}\n          onChange={handleFileInputChange}\n          accept=\"image/*\"\n          className=\"file-input\"\n        />\n      </div>\n      <div className=\"upload-instructions\">\n        <p>Hỗ trợ: JPG, JPEG, PNG, GIF (Max: 5MB)</p>\n      </div>\n    </div>\n  );\n};\n\nexport default ImageUploader;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}