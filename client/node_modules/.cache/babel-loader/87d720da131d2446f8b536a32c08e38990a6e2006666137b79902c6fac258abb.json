{"ast":null,"code":"import _objectSpread from\"C:/Users/User/OneDrive/Documents/VSCode/web/WebAPPP/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{createContext,useContext,useState,useEffect}from'react';import{createUserWithEmailAndPassword,signInWithEmailAndPassword,signOut,onAuthStateChanged,updateProfile as firebaseUpdateProfile}from'firebase/auth';import{ref,set,get}from'firebase/database';import{auth,database}from'../firebase';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export function useAuth(){return useContext(AuthContext);}export function AuthProvider(_ref){let{children}=_ref;const[currentUser,setCurrentUser]=useState(null);const[userRole,setUserRole]=useState(null);const[loading,setLoading]=useState(true);async function register(email,password,displayName){try{const userCredential=await createUserWithEmailAndPassword(auth,email,password);const user=userCredential.user;// Cập nhật displayName\nawait firebaseUpdateProfile(user,{displayName});// Lưu thông tin người dùng vào Realtime Database\nawait set(ref(database,\"users/\".concat(user.uid)),{email:user.email,displayName,role:'user',createdAt:Date.now()});return user;}catch(error){throw error;}}function login(email,password){return signInWithEmailAndPassword(auth,email,password);}function logout(){return signOut(auth);}async function getUserRole(uid){try{const userSnapshot=await get(ref(database,\"users/\".concat(uid)));if(userSnapshot.exists()){const userData=userSnapshot.val();console.log(\"Firebase user data:\",userData);console.log(\"User role:\",userData.role||'user');return userData.role||'user';}console.log(\"User not found in database, defaulting to 'user' role\");return'user';}catch(error){console.error('Lỗi khi lấy vai trò người dùng:',error);return'user';}}const updateProfile=async profileData=>{if(currentUser){await firebaseUpdateProfile(currentUser,profileData);setCurrentUser(_objectSpread(_objectSpread({},currentUser),profileData));}};useEffect(()=>{const unsubscribe=onAuthStateChanged(auth,async user=>{if(user){const role=await getUserRole(user.uid);setCurrentUser(user);setUserRole(role);console.log(\"Auth state changed - User:\",user.email,\"Role:\",role);}else{setCurrentUser(null);setUserRole(null);console.log(\"Auth state changed - User signed out\");}setLoading(false);});return()=>unsubscribe();},[]);const value={currentUser,userRole,register,login,logout,isAdmin:userRole==='admin',updateProfile};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:!loading&&children});}","map":{"version":3,"names":["React","createContext","useContext","useState","useEffect","createUserWithEmailAndPassword","signInWithEmailAndPassword","signOut","onAuthStateChanged","updateProfile","firebaseUpdateProfile","ref","set","get","auth","database","jsx","_jsx","AuthContext","useAuth","AuthProvider","_ref","children","currentUser","setCurrentUser","userRole","setUserRole","loading","setLoading","register","email","password","displayName","userCredential","user","concat","uid","role","createdAt","Date","now","error","login","logout","getUserRole","userSnapshot","exists","userData","val","console","log","profileData","_objectSpread","unsubscribe","value","isAdmin","Provider"],"sources":["C:/Users/User/OneDrive/Documents/VSCode/web/WebAPPP/client/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useContext, useState, useEffect } from 'react';\nimport {\n  createUserWithEmailAndPassword,\n  signInWithEmailAndPassword,\n  signOut,\n  onAuthStateChanged,\n  updateProfile as firebaseUpdateProfile\n} from 'firebase/auth';\nimport { ref, set, get } from 'firebase/database';\nimport { auth, database } from '../firebase';\n\nconst AuthContext = createContext();\n\nexport function useAuth() {\n  return useContext(AuthContext);\n}\n\nexport function AuthProvider({ children }) {\n  const [currentUser, setCurrentUser] = useState(null);\n  const [userRole, setUserRole] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  async function register(email, password, displayName) {\n    try {\n      const userCredential = await createUserWithEmailAndPassword(auth, email, password);\n      const user = userCredential.user;\n\n      // Cập nhật displayName\n      await firebaseUpdateProfile(user, { displayName });\n\n      // Lưu thông tin người dùng vào Realtime Database\n      await set(ref(database, `users/${user.uid}`), {\n        email: user.email,\n        displayName,\n        role: 'user',\n        createdAt: Date.now()\n      });\n\n      return user;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  function login(email, password) {\n    return signInWithEmailAndPassword(auth, email, password);\n  }\n\n  function logout() {\n    return signOut(auth);\n  }\n\n  async function getUserRole(uid) {\n    try {\n      const userSnapshot = await get(ref(database, `users/${uid}`));\n      if (userSnapshot.exists()) {\n        const userData = userSnapshot.val();\n        console.log(\"Firebase user data:\", userData);\n        console.log(\"User role:\", userData.role || 'user');\n        return userData.role || 'user';\n      }\n      console.log(\"User not found in database, defaulting to 'user' role\");\n      return 'user';\n    } catch (error) {\n      console.error('Lỗi khi lấy vai trò người dùng:', error);\n      return 'user';\n    }\n  }\n\n  const updateProfile = async (profileData) => {\n    if (currentUser) {\n      await firebaseUpdateProfile(currentUser, profileData);\n      setCurrentUser({ ...currentUser, ...profileData });\n    }\n  };\n\n  useEffect(() => {\n    const unsubscribe = onAuthStateChanged(auth, async (user) => {\n      if (user) {\n        const role = await getUserRole(user.uid);\n        setCurrentUser(user);\n        setUserRole(role);\n        console.log(\"Auth state changed - User:\", user.email, \"Role:\", role);\n      } else {\n        setCurrentUser(null);\n        setUserRole(null);\n        console.log(\"Auth state changed - User signed out\");\n      }\n      setLoading(false);\n    });\n\n    return () => unsubscribe();\n  }, []);\n\n  const value = {\n    currentUser,\n    userRole,\n    register,\n    login,\n    logout,\n    isAdmin: userRole === 'admin',\n    updateProfile\n  };\n\n  return (\n    <AuthContext.Provider value={value}>\n      {!loading && children}\n    </AuthContext.Provider>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}