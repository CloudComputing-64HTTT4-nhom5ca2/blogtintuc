{"ast":null,"code":"import _objectSpread from\"C:/Users/User/OneDrive/Documents/VSCode/web/WebAPPP/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useEffect}from'react';import{Link}from'react-router-dom';import{ref,onValue,remove}from'firebase/database';import{database}from'../../firebase';import AdminSidebar from'../../components/AdminSidebar';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const AdminPosts=()=>{const[posts,setPosts]=useState([]);const[loading,setLoading]=useState(true);const[message,setMessage]=useState(null);const[error,setError]=useState(null);useEffect(()=>{const postsRef=ref(database,'posts');const unsubscribe=onValue(postsRef,snapshot=>{const postsData=snapshot.val()||{};// Chuyển đổi object thành array và sắp xếp theo thời gian tạo (mới nhất lên đầu)\nconst postsArray=Object.keys(postsData).map(key=>_objectSpread({id:key},postsData[key])).sort((a,b)=>b.createdAt-a.createdAt);setPosts(postsArray);setLoading(false);});// Hủy đăng ký listener khi component unmount\nreturn()=>unsubscribe();},[]);const handleDelete=async postId=>{if(window.confirm('Bạn có chắc chắn muốn xóa bài viết này?')){try{await remove(ref(database,\"posts/\".concat(postId)));setMessage('Bài viết đã được xóa thành công!');// Tự động xóa thông báo sau 3 giây\nsetTimeout(()=>{setMessage(null);},3000);}catch(error){setError('Có lỗi xảy ra khi xóa bài viết.');console.error('Lỗi xóa bài viết:',error);// Tự động xóa thông báo lỗi sau 3 giây\nsetTimeout(()=>{setError(null);},3000);}}};const formatDate=timestamp=>{const date=new Date(timestamp);return date.toLocaleDateString('vi-VN',{year:'numeric',month:'long',day:'numeric'});};return/*#__PURE__*/_jsxs(\"div\",{className:\"admin-container\",children:[/*#__PURE__*/_jsx(AdminSidebar,{}),/*#__PURE__*/_jsxs(\"div\",{className:\"admin-content\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"admin-header\",children:[/*#__PURE__*/_jsx(\"h1\",{className:\"admin-title\",children:\"Qu\\u1EA3n l\\xFD b\\xE0i vi\\u1EBFt\"}),/*#__PURE__*/_jsx(\"div\",{className:\"admin-actions\",children:/*#__PURE__*/_jsxs(Link,{to:\"/admin/posts/create\",className:\"btn btn-primary\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-plus-circle\"}),\" T\\u1EA1o b\\xE0i vi\\u1EBFt m\\u1EDBi\"]})})]}),message&&/*#__PURE__*/_jsx(\"div\",{className:\"success-message\",children:message}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),loading?/*#__PURE__*/_jsx(\"div\",{className:\"loading\",children:/*#__PURE__*/_jsx(\"div\",{className:\"spinner\"})}):/*#__PURE__*/_jsx(\"div\",{className:\"posts-table-container\",children:posts.length>0?/*#__PURE__*/_jsxs(\"table\",{className:\"posts-table\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"th\",{children:\"Ti\\xEAu \\u0111\\u1EC1\"}),/*#__PURE__*/_jsx(\"th\",{children:\"T\\xE1c gi\\u1EA3\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Ng\\xE0y t\\u1EA1o\"}),/*#__PURE__*/_jsx(\"th\",{children:\"L\\u01B0\\u1EE3t xem\"}),/*#__PURE__*/_jsx(\"th\",{children:\"\\u0110\\xE1nh gi\\xE1\"}),/*#__PURE__*/_jsx(\"th\",{children:\"Thao t\\xE1c\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:posts.map(post=>/*#__PURE__*/_jsxs(\"tr\",{children:[/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"post-title-cell\",children:[post.imageUrl&&/*#__PURE__*/_jsx(\"div\",{className:\"post-thumb\",children:/*#__PURE__*/_jsx(\"img\",{src:post.imageUrl,alt:post.title})}),/*#__PURE__*/_jsxs(\"div\",{className:\"post-info\",children:[/*#__PURE__*/_jsx(Link,{to:\"/post/\".concat(post.id),className:\"post-title-link\",children:post.title}),post.category&&/*#__PURE__*/_jsx(\"span\",{className:\"post-category\",children:post.category})]})]})}),/*#__PURE__*/_jsx(\"td\",{children:post.authorName||'Không xác định'}),/*#__PURE__*/_jsx(\"td\",{children:formatDate(post.createdAt)}),/*#__PURE__*/_jsx(\"td\",{children:post.viewCount||0}),/*#__PURE__*/_jsx(\"td\",{children:post.averageRating?\"\".concat(post.averageRating.toFixed(1),\"/5 (\").concat(post.ratingCount,\")\"):'Chưa có đánh giá'}),/*#__PURE__*/_jsx(\"td\",{children:/*#__PURE__*/_jsxs(\"div\",{className:\"post-actions\",children:[/*#__PURE__*/_jsx(Link,{to:\"/admin/posts/edit/\".concat(post.id),className:\"btn-edit\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-edit\"})}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleDelete(post.id),className:\"btn-delete\",children:/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-trash-alt\"})})]})})]},post.id))})]}):/*#__PURE__*/_jsx(\"div\",{className:\"no-posts\",children:/*#__PURE__*/_jsx(\"p\",{children:\"Ch\\u01B0a c\\xF3 b\\xE0i vi\\u1EBFt n\\xE0o. H\\xE3y t\\u1EA1o b\\xE0i vi\\u1EBFt m\\u1EDBi!\"})})})]})]});};export default AdminPosts;","map":{"version":3,"names":["React","useState","useEffect","Link","ref","onValue","remove","database","AdminSidebar","jsx","_jsx","jsxs","_jsxs","AdminPosts","posts","setPosts","loading","setLoading","message","setMessage","error","setError","postsRef","unsubscribe","snapshot","postsData","val","postsArray","Object","keys","map","key","_objectSpread","id","sort","a","b","createdAt","handleDelete","postId","window","confirm","concat","setTimeout","console","formatDate","timestamp","date","Date","toLocaleDateString","year","month","day","className","children","to","length","post","imageUrl","src","alt","title","category","authorName","viewCount","averageRating","toFixed","ratingCount","onClick"],"sources":["C:/Users/User/OneDrive/Documents/VSCode/web/WebAPPP/client/src/pages/admin/AdminPosts.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { ref, onValue, remove } from 'firebase/database';\nimport { database } from '../../firebase';\nimport AdminSidebar from '../../components/AdminSidebar';\n\nconst AdminPosts = () => {\n  const [posts, setPosts] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [message, setMessage] = useState(null);\n  const [error, setError] = useState(null);\n\n  useEffect(() => {\n    const postsRef = ref(database, 'posts');\n\n    const unsubscribe = onValue(postsRef, (snapshot) => {\n      const postsData = snapshot.val() || {};\n\n      // Chuyển đổi object thành array và sắp xếp theo thời gian tạo (mới nhất lên đầu)\n      const postsArray = Object.keys(postsData).map(key => ({\n        id: key,\n        ...postsData[key]\n      })).sort((a, b) => b.createdAt - a.createdAt);\n\n      setPosts(postsArray);\n      setLoading(false);\n    });\n\n    // Hủy đăng ký listener khi component unmount\n    return () => unsubscribe();\n  }, []);\n\n  const handleDelete = async (postId) => {\n    if (window.confirm('Bạn có chắc chắn muốn xóa bài viết này?')) {\n      try {\n        await remove(ref(database, `posts/${postId}`));\n        setMessage('Bài viết đã được xóa thành công!');\n\n        // Tự động xóa thông báo sau 3 giây\n        setTimeout(() => {\n          setMessage(null);\n        }, 3000);\n      } catch (error) {\n        setError('Có lỗi xảy ra khi xóa bài viết.');\n        console.error('Lỗi xóa bài viết:', error);\n\n        // Tự động xóa thông báo lỗi sau 3 giây\n        setTimeout(() => {\n          setError(null);\n        }, 3000);\n      }\n    }\n  };\n\n  const formatDate = (timestamp) => {\n    const date = new Date(timestamp);\n    return date.toLocaleDateString('vi-VN', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric'\n    });\n  };\n\n  return (\n    <div className=\"admin-container\">\n      <AdminSidebar />\n\n      <div className=\"admin-content\">\n        <div className=\"admin-header\">\n          <h1 className=\"admin-title\">Quản lý bài viết</h1>\n\n          <div className=\"admin-actions\">\n            <Link to=\"/admin/posts/create\" className=\"btn btn-primary\">\n              <i className=\"fas fa-plus-circle\"></i> Tạo bài viết mới\n            </Link>\n          </div>\n        </div>\n\n        {message && <div className=\"success-message\">{message}</div>}\n        {error && <div className=\"error-message\">{error}</div>}\n\n        {loading ? (\n          <div className=\"loading\">\n            <div className=\"spinner\"></div>\n          </div>\n        ) : (\n          <div className=\"posts-table-container\">\n            {posts.length > 0 ? (\n              <table className=\"posts-table\">\n                <thead>\n                  <tr>\n                    <th>Tiêu đề</th>\n                    <th>Tác giả</th>\n                    <th>Ngày tạo</th>\n                    <th>Lượt xem</th>\n                    <th>Đánh giá</th>\n                    <th>Thao tác</th>\n                  </tr>\n                </thead>\n                <tbody>\n                  {posts.map(post => (\n                    <tr key={post.id}>\n                      <td>\n                        <div className=\"post-title-cell\">\n                          {post.imageUrl && (\n                            <div className=\"post-thumb\">\n                              <img src={post.imageUrl} alt={post.title} />\n                            </div>\n                          )}\n                          <div className=\"post-info\">\n                            <Link to={`/post/${post.id}`} className=\"post-title-link\">\n                              {post.title}\n                            </Link>\n                            {post.category && (\n                              <span className=\"post-category\">{post.category}</span>\n                            )}\n                          </div>\n                        </div>\n                      </td>\n                      <td>{post.authorName || 'Không xác định'}</td>\n                      <td>{formatDate(post.createdAt)}</td>\n                      <td>{post.viewCount || 0}</td>\n                      <td>\n                        {post.averageRating\n                          ? `${post.averageRating.toFixed(1)}/5 (${post.ratingCount})`\n                          : 'Chưa có đánh giá'}\n                      </td>\n                      <td>\n                        <div className=\"post-actions\">\n                          <Link to={`/admin/posts/edit/${post.id}`} className=\"btn-edit\">\n                            <i className=\"fas fa-edit\"></i>\n                          </Link>\n                          <button\n                            onClick={() => handleDelete(post.id)}\n                            className=\"btn-delete\"\n                          >\n                            <i className=\"fas fa-trash-alt\"></i>\n                          </button>\n                        </div>\n                      </td>\n                    </tr>\n                  ))}\n                </tbody>\n              </table>\n            ) : (\n              <div className=\"no-posts\">\n                <p>Chưa có bài viết nào. Hãy tạo bài viết mới!</p>\n              </div>\n            )}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n};\n\nexport default AdminPosts;\n"],"mappings":"+IAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,SAAS,KAAQ,OAAO,CAClD,OAASC,IAAI,KAAQ,kBAAkB,CACvC,OAASC,GAAG,CAAEC,OAAO,CAAEC,MAAM,KAAQ,mBAAmB,CACxD,OAASC,QAAQ,KAAQ,gBAAgB,CACzC,MAAO,CAAAC,YAAY,KAAM,+BAA+B,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEzD,KAAM,CAAAC,UAAU,CAAGA,CAAA,GAAM,CACvB,KAAM,CAACC,KAAK,CAAEC,QAAQ,CAAC,CAAGd,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAACe,OAAO,CAAEC,UAAU,CAAC,CAAGhB,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACiB,OAAO,CAAEC,UAAU,CAAC,CAAGlB,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACmB,KAAK,CAAEC,QAAQ,CAAC,CAAGpB,QAAQ,CAAC,IAAI,CAAC,CAExCC,SAAS,CAAC,IAAM,CACd,KAAM,CAAAoB,QAAQ,CAAGlB,GAAG,CAACG,QAAQ,CAAE,OAAO,CAAC,CAEvC,KAAM,CAAAgB,WAAW,CAAGlB,OAAO,CAACiB,QAAQ,CAAGE,QAAQ,EAAK,CAClD,KAAM,CAAAC,SAAS,CAAGD,QAAQ,CAACE,GAAG,CAAC,CAAC,EAAI,CAAC,CAAC,CAEtC;AACA,KAAM,CAAAC,UAAU,CAAGC,MAAM,CAACC,IAAI,CAACJ,SAAS,CAAC,CAACK,GAAG,CAACC,GAAG,EAAAC,aAAA,EAC/CC,EAAE,CAAEF,GAAG,EACJN,SAAS,CAACM,GAAG,CAAC,CACjB,CAAC,CAACG,IAAI,CAAC,CAACC,CAAC,CAAEC,CAAC,GAAKA,CAAC,CAACC,SAAS,CAAGF,CAAC,CAACE,SAAS,CAAC,CAE7CtB,QAAQ,CAACY,UAAU,CAAC,CACpBV,UAAU,CAAC,KAAK,CAAC,CACnB,CAAC,CAAC,CAEF;AACA,MAAO,IAAMM,WAAW,CAAC,CAAC,CAC5B,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAe,YAAY,CAAG,KAAO,CAAAC,MAAM,EAAK,CACrC,GAAIC,MAAM,CAACC,OAAO,CAAC,yCAAyC,CAAC,CAAE,CAC7D,GAAI,CACF,KAAM,CAAAnC,MAAM,CAACF,GAAG,CAACG,QAAQ,UAAAmC,MAAA,CAAWH,MAAM,CAAE,CAAC,CAAC,CAC9CpB,UAAU,CAAC,kCAAkC,CAAC,CAE9C;AACAwB,UAAU,CAAC,IAAM,CACfxB,UAAU,CAAC,IAAI,CAAC,CAClB,CAAC,CAAE,IAAI,CAAC,CACV,CAAE,MAAOC,KAAK,CAAE,CACdC,QAAQ,CAAC,iCAAiC,CAAC,CAC3CuB,OAAO,CAACxB,KAAK,CAAC,mBAAmB,CAAEA,KAAK,CAAC,CAEzC;AACAuB,UAAU,CAAC,IAAM,CACftB,QAAQ,CAAC,IAAI,CAAC,CAChB,CAAC,CAAE,IAAI,CAAC,CACV,CACF,CACF,CAAC,CAED,KAAM,CAAAwB,UAAU,CAAIC,SAAS,EAAK,CAChC,KAAM,CAAAC,IAAI,CAAG,GAAI,CAAAC,IAAI,CAACF,SAAS,CAAC,CAChC,MAAO,CAAAC,IAAI,CAACE,kBAAkB,CAAC,OAAO,CAAE,CACtCC,IAAI,CAAE,SAAS,CACfC,KAAK,CAAE,MAAM,CACbC,GAAG,CAAE,SACP,CAAC,CAAC,CACJ,CAAC,CAED,mBACExC,KAAA,QAAKyC,SAAS,CAAC,iBAAiB,CAAAC,QAAA,eAC9B5C,IAAA,CAACF,YAAY,GAAE,CAAC,cAEhBI,KAAA,QAAKyC,SAAS,CAAC,eAAe,CAAAC,QAAA,eAC5B1C,KAAA,QAAKyC,SAAS,CAAC,cAAc,CAAAC,QAAA,eAC3B5C,IAAA,OAAI2C,SAAS,CAAC,aAAa,CAAAC,QAAA,CAAC,kCAAgB,CAAI,CAAC,cAEjD5C,IAAA,QAAK2C,SAAS,CAAC,eAAe,CAAAC,QAAA,cAC5B1C,KAAA,CAACT,IAAI,EAACoD,EAAE,CAAC,qBAAqB,CAACF,SAAS,CAAC,iBAAiB,CAAAC,QAAA,eACxD5C,IAAA,MAAG2C,SAAS,CAAC,oBAAoB,CAAI,CAAC,sCACxC,EAAM,CAAC,CACJ,CAAC,EACH,CAAC,CAELnC,OAAO,eAAIR,IAAA,QAAK2C,SAAS,CAAC,iBAAiB,CAAAC,QAAA,CAAEpC,OAAO,CAAM,CAAC,CAC3DE,KAAK,eAAIV,IAAA,QAAK2C,SAAS,CAAC,eAAe,CAAAC,QAAA,CAAElC,KAAK,CAAM,CAAC,CAErDJ,OAAO,cACNN,IAAA,QAAK2C,SAAS,CAAC,SAAS,CAAAC,QAAA,cACtB5C,IAAA,QAAK2C,SAAS,CAAC,SAAS,CAAM,CAAC,CAC5B,CAAC,cAEN3C,IAAA,QAAK2C,SAAS,CAAC,uBAAuB,CAAAC,QAAA,CACnCxC,KAAK,CAAC0C,MAAM,CAAG,CAAC,cACf5C,KAAA,UAAOyC,SAAS,CAAC,aAAa,CAAAC,QAAA,eAC5B5C,IAAA,UAAA4C,QAAA,cACE1C,KAAA,OAAA0C,QAAA,eACE5C,IAAA,OAAA4C,QAAA,CAAI,sBAAO,CAAI,CAAC,cAChB5C,IAAA,OAAA4C,QAAA,CAAI,iBAAO,CAAI,CAAC,cAChB5C,IAAA,OAAA4C,QAAA,CAAI,kBAAQ,CAAI,CAAC,cACjB5C,IAAA,OAAA4C,QAAA,CAAI,oBAAQ,CAAI,CAAC,cACjB5C,IAAA,OAAA4C,QAAA,CAAI,qBAAQ,CAAI,CAAC,cACjB5C,IAAA,OAAA4C,QAAA,CAAI,aAAQ,CAAI,CAAC,EACf,CAAC,CACA,CAAC,cACR5C,IAAA,UAAA4C,QAAA,CACGxC,KAAK,CAACgB,GAAG,CAAC2B,IAAI,eACb7C,KAAA,OAAA0C,QAAA,eACE5C,IAAA,OAAA4C,QAAA,cACE1C,KAAA,QAAKyC,SAAS,CAAC,iBAAiB,CAAAC,QAAA,EAC7BG,IAAI,CAACC,QAAQ,eACZhD,IAAA,QAAK2C,SAAS,CAAC,YAAY,CAAAC,QAAA,cACzB5C,IAAA,QAAKiD,GAAG,CAAEF,IAAI,CAACC,QAAS,CAACE,GAAG,CAAEH,IAAI,CAACI,KAAM,CAAE,CAAC,CACzC,CACN,cACDjD,KAAA,QAAKyC,SAAS,CAAC,WAAW,CAAAC,QAAA,eACxB5C,IAAA,CAACP,IAAI,EAACoD,EAAE,UAAAb,MAAA,CAAWe,IAAI,CAACxB,EAAE,CAAG,CAACoB,SAAS,CAAC,iBAAiB,CAAAC,QAAA,CACtDG,IAAI,CAACI,KAAK,CACP,CAAC,CACNJ,IAAI,CAACK,QAAQ,eACZpD,IAAA,SAAM2C,SAAS,CAAC,eAAe,CAAAC,QAAA,CAAEG,IAAI,CAACK,QAAQ,CAAO,CACtD,EACE,CAAC,EACH,CAAC,CACJ,CAAC,cACLpD,IAAA,OAAA4C,QAAA,CAAKG,IAAI,CAACM,UAAU,EAAI,gBAAgB,CAAK,CAAC,cAC9CrD,IAAA,OAAA4C,QAAA,CAAKT,UAAU,CAACY,IAAI,CAACpB,SAAS,CAAC,CAAK,CAAC,cACrC3B,IAAA,OAAA4C,QAAA,CAAKG,IAAI,CAACO,SAAS,EAAI,CAAC,CAAK,CAAC,cAC9BtD,IAAA,OAAA4C,QAAA,CACGG,IAAI,CAACQ,aAAa,IAAAvB,MAAA,CACZe,IAAI,CAACQ,aAAa,CAACC,OAAO,CAAC,CAAC,CAAC,SAAAxB,MAAA,CAAOe,IAAI,CAACU,WAAW,MACvD,kBAAkB,CACpB,CAAC,cACLzD,IAAA,OAAA4C,QAAA,cACE1C,KAAA,QAAKyC,SAAS,CAAC,cAAc,CAAAC,QAAA,eAC3B5C,IAAA,CAACP,IAAI,EAACoD,EAAE,sBAAAb,MAAA,CAAuBe,IAAI,CAACxB,EAAE,CAAG,CAACoB,SAAS,CAAC,UAAU,CAAAC,QAAA,cAC5D5C,IAAA,MAAG2C,SAAS,CAAC,aAAa,CAAI,CAAC,CAC3B,CAAC,cACP3C,IAAA,WACE0D,OAAO,CAAEA,CAAA,GAAM9B,YAAY,CAACmB,IAAI,CAACxB,EAAE,CAAE,CACrCoB,SAAS,CAAC,YAAY,CAAAC,QAAA,cAEtB5C,IAAA,MAAG2C,SAAS,CAAC,kBAAkB,CAAI,CAAC,CAC9B,CAAC,EACN,CAAC,CACJ,CAAC,GAtCEI,IAAI,CAACxB,EAuCV,CACL,CAAC,CACG,CAAC,EACH,CAAC,cAERvB,IAAA,QAAK2C,SAAS,CAAC,UAAU,CAAAC,QAAA,cACvB5C,IAAA,MAAA4C,QAAA,CAAG,qFAA2C,CAAG,CAAC,CAC/C,CACN,CACE,CACN,EACE,CAAC,EACH,CAAC,CAEV,CAAC,CAED,cAAe,CAAAzC,UAAU","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}