{"ast":null,"code":"import React,{useState}from'react';import{useNavigate}from'react-router-dom';import{ref,push,serverTimestamp}from'firebase/database';import{ref as storageRef,uploadBytes,getDownloadURL}from'firebase/storage';import{database,storage}from'../../firebase';import{useAuth}from'../../context/AuthContext';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const CreatePost=()=>{const{currentUser}=useAuth();const navigate=useNavigate();const[title,setTitle]=useState('');const[content,setContent]=useState('');const[category,setCategory]=useState('');const[tags,setTags]=useState('');const[image,setImage]=useState(null);const[imagePreview,setImagePreview]=useState('');const[loading,setLoading]=useState(false);const[error,setError]=useState('');const handleImageChange=e=>{if(e.target.files[0]){const file=e.target.files[0];setImage(file);// Tạo URL xem trước cho hình ảnh\nconst reader=new FileReader();reader.onloadend=()=>{setImagePreview(reader.result);};reader.readAsDataURL(file);}};const handleSubmit=async e=>{e.preventDefault();// Kiểm tra các trường bắt buộc\nif(!title||!content||!category){setError('Vui lòng điền đầy đủ thông tin (tiêu đề, nội dung, danh mục)');return;}setLoading(true);setError('');try{let imageUrl='';// Nếu có hình ảnh, tải lên Cloud Storage\nif(image){const imageStorageRef=storageRef(storage,\"images/\".concat(Date.now(),\"_\").concat(image.name));await uploadBytes(imageStorageRef,image);imageUrl=await getDownloadURL(imageStorageRef);}// Tạo bài viết mới\nconst postsRef=ref(database,'posts');const newPostRef=push(postsRef);await newPostRef.set({title,content,category,tags:tags.split(',').map(tag=>tag.trim()).filter(tag=>tag),imageUrl,author:currentUser.uid,authorName:currentUser.displayName||'Admin',createdAt:serverTimestamp(),updatedAt:serverTimestamp(),viewCount:0,averageRating:0,ratingCount:0});// Chuyển hướng đến trang quản lý bài viết\nnavigate('/admin/posts');}catch(error){console.error('Lỗi khi tạo bài viết:',error);setError('Không thể tạo bài viết. Vui lòng thử lại sau.');}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{className:\"create-post-container\",children:[/*#__PURE__*/_jsx(\"h1\",{children:\"T\\u1EA1o b\\xE0i vi\\u1EBFt m\\u1EDBi\"}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"error-message\",children:error}),/*#__PURE__*/_jsxs(\"form\",{onSubmit:handleSubmit,className:\"post-form\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"title\",children:\"Ti\\xEAu \\u0111\\u1EC1 *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"title\",value:title,onChange:e=>setTitle(e.target.value),required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"category\",children:\"Danh m\\u1EE5c *\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"category\",value:category,onChange:e=>setCategory(e.target.value),required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"tags\",children:\"Th\\u1EBB (c\\xE1ch nhau b\\u1EDFi d\\u1EA5u ph\\u1EA9y)\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",id:\"tags\",value:tags,onChange:e=>setTags(e.target.value),placeholder:\"Tin t\\u1EE9c, C\\xF4ng ngh\\u1EC7, ...\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"image\",children:\"H\\xECnh \\u1EA3nh\"}),/*#__PURE__*/_jsx(\"input\",{type:\"file\",id:\"image\",onChange:handleImageChange,accept:\"image/*\"}),imagePreview&&/*#__PURE__*/_jsx(\"div\",{className:\"image-preview\",children:/*#__PURE__*/_jsx(\"img\",{src:imagePreview,alt:\"Preview\"})})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-group\",children:[/*#__PURE__*/_jsx(\"label\",{htmlFor:\"content\",children:\"N\\u1ED9i dung *\"}),/*#__PURE__*/_jsx(\"textarea\",{id:\"content\",value:content,onChange:e=>setContent(e.target.value),rows:15,required:true})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"form-actions\",children:[/*#__PURE__*/_jsx(\"button\",{type:\"button\",onClick:()=>navigate('/admin/posts'),className:\"btn-secondary\",children:\"H\\u1EE7y b\\u1ECF\"}),/*#__PURE__*/_jsx(\"button\",{type:\"submit\",disabled:loading,className:\"btn-primary\",children:loading?'Đang tạo...':'Tạo bài viết'})]})]})]});};export default CreatePost;","map":{"version":3,"names":["React","useState","useNavigate","ref","push","serverTimestamp","storageRef","uploadBytes","getDownloadURL","database","storage","useAuth","jsx","_jsx","jsxs","_jsxs","CreatePost","currentUser","navigate","title","setTitle","content","setContent","category","setCategory","tags","setTags","image","setImage","imagePreview","setImagePreview","loading","setLoading","error","setError","handleImageChange","e","target","files","file","reader","FileReader","onloadend","result","readAsDataURL","handleSubmit","preventDefault","imageUrl","imageStorageRef","concat","Date","now","name","postsRef","newPostRef","set","split","map","tag","trim","filter","author","uid","authorName","displayName","createdAt","updatedAt","viewCount","averageRating","ratingCount","console","className","children","onSubmit","htmlFor","type","id","value","onChange","required","placeholder","accept","src","alt","rows","onClick","disabled"],"sources":["C:/Users/User/OneDrive/Documents/VSCode/web/WebAPPP/client/src/pages/admin/CreatePost.js"],"sourcesContent":["import React, { useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { ref, push, serverTimestamp } from 'firebase/database';\nimport { ref as storageRef, uploadBytes, getDownloadURL } from 'firebase/storage';\nimport { database, storage } from '../../firebase';\nimport { useAuth } from '../../context/AuthContext';\n\nconst CreatePost = () => {\n  const { currentUser } = useAuth();\n  const navigate = useNavigate();\n\n  const [title, setTitle] = useState('');\n  const [content, setContent] = useState('');\n  const [category, setCategory] = useState('');\n  const [tags, setTags] = useState('');\n  const [image, setImage] = useState(null);\n  const [imagePreview, setImagePreview] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n\n  const handleImageChange = (e) => {\n    if (e.target.files[0]) {\n      const file = e.target.files[0];\n      setImage(file);\n\n      // Tạo URL xem trước cho hình ảnh\n      const reader = new FileReader();\n      reader.onloadend = () => {\n        setImagePreview(reader.result);\n      };\n      reader.readAsDataURL(file);\n    }\n  };\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n\n    // Kiểm tra các trường bắt buộc\n    if (!title || !content || !category) {\n      setError('Vui lòng điền đầy đủ thông tin (tiêu đề, nội dung, danh mục)');\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n\n    try {\n      let imageUrl = '';\n\n      // Nếu có hình ảnh, tải lên Cloud Storage\n      if (image) {\n        const imageStorageRef = storageRef(storage, `images/${Date.now()}_${image.name}`);\n        await uploadBytes(imageStorageRef, image);\n        imageUrl = await getDownloadURL(imageStorageRef);\n      }\n\n      // Tạo bài viết mới\n      const postsRef = ref(database, 'posts');\n      const newPostRef = push(postsRef);\n\n      await newPostRef.set({\n        title,\n        content,\n        category,\n        tags: tags.split(',').map(tag => tag.trim()).filter(tag => tag),\n        imageUrl,\n        author: currentUser.uid,\n        authorName: currentUser.displayName || 'Admin',\n        createdAt: serverTimestamp(),\n        updatedAt: serverTimestamp(),\n        viewCount: 0,\n        averageRating: 0,\n        ratingCount: 0\n      });\n\n      // Chuyển hướng đến trang quản lý bài viết\n      navigate('/admin/posts');\n\n    } catch (error) {\n      console.error('Lỗi khi tạo bài viết:', error);\n      setError('Không thể tạo bài viết. Vui lòng thử lại sau.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div className=\"create-post-container\">\n      <h1>Tạo bài viết mới</h1>\n\n      {error && <div className=\"error-message\">{error}</div>}\n\n      <form onSubmit={handleSubmit} className=\"post-form\">\n        <div className=\"form-group\">\n          <label htmlFor=\"title\">Tiêu đề *</label>\n          <input\n            type=\"text\"\n            id=\"title\"\n            value={title}\n            onChange={(e) => setTitle(e.target.value)}\n            required\n          />\n        </div>\n\n        <div className=\"form-group\">\n          <label htmlFor=\"category\">Danh mục *</label>\n          <input\n            type=\"text\"\n            id=\"category\"\n            value={category}\n            onChange={(e) => setCategory(e.target.value)}\n            required\n          />\n        </div>\n\n        <div className=\"form-group\">\n          <label htmlFor=\"tags\">Thẻ (cách nhau bởi dấu phẩy)</label>\n          <input\n            type=\"text\"\n            id=\"tags\"\n            value={tags}\n            onChange={(e) => setTags(e.target.value)}\n            placeholder=\"Tin tức, Công nghệ, ...\"\n          />\n        </div>\n\n        <div className=\"form-group\">\n          <label htmlFor=\"image\">Hình ảnh</label>\n          <input\n            type=\"file\"\n            id=\"image\"\n            onChange={handleImageChange}\n            accept=\"image/*\"\n          />\n          {imagePreview && (\n            <div className=\"image-preview\">\n              <img src={imagePreview} alt=\"Preview\" />\n            </div>\n          )}\n        </div>\n\n        <div className=\"form-group\">\n          <label htmlFor=\"content\">Nội dung *</label>\n          <textarea\n            id=\"content\"\n            value={content}\n            onChange={(e) => setContent(e.target.value)}\n            rows={15}\n            required\n          ></textarea>\n        </div>\n\n        <div className=\"form-actions\">\n          <button type=\"button\" onClick={() => navigate('/admin/posts')} className=\"btn-secondary\">\n            Hủy bỏ\n          </button>\n          <button type=\"submit\" disabled={loading} className=\"btn-primary\">\n            {loading ? 'Đang tạo...' : 'Tạo bài viết'}\n          </button>\n        </div>\n      </form>\n    </div>\n  );\n};\n\nexport default CreatePost;\n"],"mappings":"AAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,KAAQ,OAAO,CACvC,OAASC,WAAW,KAAQ,kBAAkB,CAC9C,OAASC,GAAG,CAAEC,IAAI,CAAEC,eAAe,KAAQ,mBAAmB,CAC9D,OAASF,GAAG,GAAI,CAAAG,UAAU,CAAEC,WAAW,CAAEC,cAAc,KAAQ,kBAAkB,CACjF,OAASC,QAAQ,CAAEC,OAAO,KAAQ,gBAAgB,CAClD,OAASC,OAAO,KAAQ,2BAA2B,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,yBAEpD,KAAM,CAAAC,UAAU,CAAGA,CAAA,GAAM,CACvB,KAAM,CAAEC,WAAY,CAAC,CAAGN,OAAO,CAAC,CAAC,CACjC,KAAM,CAAAO,QAAQ,CAAGhB,WAAW,CAAC,CAAC,CAE9B,KAAM,CAACiB,KAAK,CAAEC,QAAQ,CAAC,CAAGnB,QAAQ,CAAC,EAAE,CAAC,CACtC,KAAM,CAACoB,OAAO,CAAEC,UAAU,CAAC,CAAGrB,QAAQ,CAAC,EAAE,CAAC,CAC1C,KAAM,CAACsB,QAAQ,CAAEC,WAAW,CAAC,CAAGvB,QAAQ,CAAC,EAAE,CAAC,CAC5C,KAAM,CAACwB,IAAI,CAAEC,OAAO,CAAC,CAAGzB,QAAQ,CAAC,EAAE,CAAC,CACpC,KAAM,CAAC0B,KAAK,CAAEC,QAAQ,CAAC,CAAG3B,QAAQ,CAAC,IAAI,CAAC,CACxC,KAAM,CAAC4B,YAAY,CAAEC,eAAe,CAAC,CAAG7B,QAAQ,CAAC,EAAE,CAAC,CACpD,KAAM,CAAC8B,OAAO,CAAEC,UAAU,CAAC,CAAG/B,QAAQ,CAAC,KAAK,CAAC,CAC7C,KAAM,CAACgC,KAAK,CAAEC,QAAQ,CAAC,CAAGjC,QAAQ,CAAC,EAAE,CAAC,CAEtC,KAAM,CAAAkC,iBAAiB,CAAIC,CAAC,EAAK,CAC/B,GAAIA,CAAC,CAACC,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC,CAAE,CACrB,KAAM,CAAAC,IAAI,CAAGH,CAAC,CAACC,MAAM,CAACC,KAAK,CAAC,CAAC,CAAC,CAC9BV,QAAQ,CAACW,IAAI,CAAC,CAEd;AACA,KAAM,CAAAC,MAAM,CAAG,GAAI,CAAAC,UAAU,CAAC,CAAC,CAC/BD,MAAM,CAACE,SAAS,CAAG,IAAM,CACvBZ,eAAe,CAACU,MAAM,CAACG,MAAM,CAAC,CAChC,CAAC,CACDH,MAAM,CAACI,aAAa,CAACL,IAAI,CAAC,CAC5B,CACF,CAAC,CAED,KAAM,CAAAM,YAAY,CAAG,KAAO,CAAAT,CAAC,EAAK,CAChCA,CAAC,CAACU,cAAc,CAAC,CAAC,CAElB;AACA,GAAI,CAAC3B,KAAK,EAAI,CAACE,OAAO,EAAI,CAACE,QAAQ,CAAE,CACnCW,QAAQ,CAAC,8DAA8D,CAAC,CACxE,OACF,CAEAF,UAAU,CAAC,IAAI,CAAC,CAChBE,QAAQ,CAAC,EAAE,CAAC,CAEZ,GAAI,CACF,GAAI,CAAAa,QAAQ,CAAG,EAAE,CAEjB;AACA,GAAIpB,KAAK,CAAE,CACT,KAAM,CAAAqB,eAAe,CAAG1C,UAAU,CAACI,OAAO,WAAAuC,MAAA,CAAYC,IAAI,CAACC,GAAG,CAAC,CAAC,MAAAF,MAAA,CAAItB,KAAK,CAACyB,IAAI,CAAE,CAAC,CACjF,KAAM,CAAA7C,WAAW,CAACyC,eAAe,CAAErB,KAAK,CAAC,CACzCoB,QAAQ,CAAG,KAAM,CAAAvC,cAAc,CAACwC,eAAe,CAAC,CAClD,CAEA;AACA,KAAM,CAAAK,QAAQ,CAAGlD,GAAG,CAACM,QAAQ,CAAE,OAAO,CAAC,CACvC,KAAM,CAAA6C,UAAU,CAAGlD,IAAI,CAACiD,QAAQ,CAAC,CAEjC,KAAM,CAAAC,UAAU,CAACC,GAAG,CAAC,CACnBpC,KAAK,CACLE,OAAO,CACPE,QAAQ,CACRE,IAAI,CAAEA,IAAI,CAAC+B,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAACC,GAAG,EAAIA,GAAG,CAACC,IAAI,CAAC,CAAC,CAAC,CAACC,MAAM,CAACF,GAAG,EAAIA,GAAG,CAAC,CAC/DX,QAAQ,CACRc,MAAM,CAAE5C,WAAW,CAAC6C,GAAG,CACvBC,UAAU,CAAE9C,WAAW,CAAC+C,WAAW,EAAI,OAAO,CAC9CC,SAAS,CAAE5D,eAAe,CAAC,CAAC,CAC5B6D,SAAS,CAAE7D,eAAe,CAAC,CAAC,CAC5B8D,SAAS,CAAE,CAAC,CACZC,aAAa,CAAE,CAAC,CAChBC,WAAW,CAAE,CACf,CAAC,CAAC,CAEF;AACAnD,QAAQ,CAAC,cAAc,CAAC,CAE1B,CAAE,MAAOe,KAAK,CAAE,CACdqC,OAAO,CAACrC,KAAK,CAAC,uBAAuB,CAAEA,KAAK,CAAC,CAC7CC,QAAQ,CAAC,+CAA+C,CAAC,CAC3D,CAAC,OAAS,CACRF,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAED,mBACEjB,KAAA,QAAKwD,SAAS,CAAC,uBAAuB,CAAAC,QAAA,eACpC3D,IAAA,OAAA2D,QAAA,CAAI,oCAAgB,CAAI,CAAC,CAExBvC,KAAK,eAAIpB,IAAA,QAAK0D,SAAS,CAAC,eAAe,CAAAC,QAAA,CAAEvC,KAAK,CAAM,CAAC,cAEtDlB,KAAA,SAAM0D,QAAQ,CAAE5B,YAAa,CAAC0B,SAAS,CAAC,WAAW,CAAAC,QAAA,eACjDzD,KAAA,QAAKwD,SAAS,CAAC,YAAY,CAAAC,QAAA,eACzB3D,IAAA,UAAO6D,OAAO,CAAC,OAAO,CAAAF,QAAA,CAAC,wBAAS,CAAO,CAAC,cACxC3D,IAAA,UACE8D,IAAI,CAAC,MAAM,CACXC,EAAE,CAAC,OAAO,CACVC,KAAK,CAAE1D,KAAM,CACb2D,QAAQ,CAAG1C,CAAC,EAAKhB,QAAQ,CAACgB,CAAC,CAACC,MAAM,CAACwC,KAAK,CAAE,CAC1CE,QAAQ,MACT,CAAC,EACC,CAAC,cAENhE,KAAA,QAAKwD,SAAS,CAAC,YAAY,CAAAC,QAAA,eACzB3D,IAAA,UAAO6D,OAAO,CAAC,UAAU,CAAAF,QAAA,CAAC,iBAAU,CAAO,CAAC,cAC5C3D,IAAA,UACE8D,IAAI,CAAC,MAAM,CACXC,EAAE,CAAC,UAAU,CACbC,KAAK,CAAEtD,QAAS,CAChBuD,QAAQ,CAAG1C,CAAC,EAAKZ,WAAW,CAACY,CAAC,CAACC,MAAM,CAACwC,KAAK,CAAE,CAC7CE,QAAQ,MACT,CAAC,EACC,CAAC,cAENhE,KAAA,QAAKwD,SAAS,CAAC,YAAY,CAAAC,QAAA,eACzB3D,IAAA,UAAO6D,OAAO,CAAC,MAAM,CAAAF,QAAA,CAAC,qDAA4B,CAAO,CAAC,cAC1D3D,IAAA,UACE8D,IAAI,CAAC,MAAM,CACXC,EAAE,CAAC,MAAM,CACTC,KAAK,CAAEpD,IAAK,CACZqD,QAAQ,CAAG1C,CAAC,EAAKV,OAAO,CAACU,CAAC,CAACC,MAAM,CAACwC,KAAK,CAAE,CACzCG,WAAW,CAAC,sCAAyB,CACtC,CAAC,EACC,CAAC,cAENjE,KAAA,QAAKwD,SAAS,CAAC,YAAY,CAAAC,QAAA,eACzB3D,IAAA,UAAO6D,OAAO,CAAC,OAAO,CAAAF,QAAA,CAAC,kBAAQ,CAAO,CAAC,cACvC3D,IAAA,UACE8D,IAAI,CAAC,MAAM,CACXC,EAAE,CAAC,OAAO,CACVE,QAAQ,CAAE3C,iBAAkB,CAC5B8C,MAAM,CAAC,SAAS,CACjB,CAAC,CACDpD,YAAY,eACXhB,IAAA,QAAK0D,SAAS,CAAC,eAAe,CAAAC,QAAA,cAC5B3D,IAAA,QAAKqE,GAAG,CAAErD,YAAa,CAACsD,GAAG,CAAC,SAAS,CAAE,CAAC,CACrC,CACN,EACE,CAAC,cAENpE,KAAA,QAAKwD,SAAS,CAAC,YAAY,CAAAC,QAAA,eACzB3D,IAAA,UAAO6D,OAAO,CAAC,SAAS,CAAAF,QAAA,CAAC,iBAAU,CAAO,CAAC,cAC3C3D,IAAA,aACE+D,EAAE,CAAC,SAAS,CACZC,KAAK,CAAExD,OAAQ,CACfyD,QAAQ,CAAG1C,CAAC,EAAKd,UAAU,CAACc,CAAC,CAACC,MAAM,CAACwC,KAAK,CAAE,CAC5CO,IAAI,CAAE,EAAG,CACTL,QAAQ,MACC,CAAC,EACT,CAAC,cAENhE,KAAA,QAAKwD,SAAS,CAAC,cAAc,CAAAC,QAAA,eAC3B3D,IAAA,WAAQ8D,IAAI,CAAC,QAAQ,CAACU,OAAO,CAAEA,CAAA,GAAMnE,QAAQ,CAAC,cAAc,CAAE,CAACqD,SAAS,CAAC,eAAe,CAAAC,QAAA,CAAC,kBAEzF,CAAQ,CAAC,cACT3D,IAAA,WAAQ8D,IAAI,CAAC,QAAQ,CAACW,QAAQ,CAAEvD,OAAQ,CAACwC,SAAS,CAAC,aAAa,CAAAC,QAAA,CAC7DzC,OAAO,CAAG,aAAa,CAAG,cAAc,CACnC,CAAC,EACN,CAAC,EACF,CAAC,EACJ,CAAC,CAEV,CAAC,CAED,cAAe,CAAAf,UAAU","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}